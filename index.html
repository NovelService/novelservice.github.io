<!DOCTYPE html>
<html>

<body>

    <h1>Novel Service</h1>

    <p>Download any webpage as an ebook. It uses the reader mode from firefox for that.</p>
    <p>Enter any amount of urls into the input field. Each url needs to be separated with ,</p>
    <p>So for example:url1,url2,url3</p>
    <p>Then send the request and then poll the result until the status is marked as "done" and then download the file from the provided url</p>
    <p>source: <a href="https://github.com/NovelService/novelservice.github.io" target="_blank">github</a> </p>

    <h2>Your id</h2>
    <p id="id"></p>

    <h2>Start download</h2>
    <label for="url">urls</label>
    <input type="text" id="url" name="url" size="100"><br><br>
    <input id="post" type="submit" value="Submit">

    <h2>Get result</h2>
    <label for="getId">Id</label>
    <input type="text" id="getId" name="getId" size="100"><br><br>
    <input id="get" type="submit" value="Submit">
    <div>

        <label for="status">status</label>
        <p id="status" name="status"></p>
        <label for="url">url</label>
        <p id="urlresult" name="url"></p>
    </div>


    <script>
        function createUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8)
                return v.toString(16)
            })
        }

        var id = createUUID()
        document.getElementById("id").innerText = id
        document.getElementById("getId").value = id

        var post = document.getElementById("post")
        post.addEventListener("click", () => {
<<<<<<< HEAD
            post.disabled = true;
            post.value = "loading"

            var url = document.getElementById("url").value.trim()
=======
            var urls = document.getElementById("url").value.trim().split(",")
>>>>>>> 043e387 (Allow sending multple urls at once)

            var data = {
                id: id,
                urls: urls,
                options: {
                    output: id + ".epub"
                }
            }
            console.log("post")
            console.log(data)
            fetch("https://my6pmey7adsjxo46zbqxk3nw7e0nvazt.lambda-url.eu-central-1.on.aws/", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).then(res => {
                post.disabled = false;
                post.value = "submit"

                console.log("post request complete! response:", res)
            }).catch(e => {
                post.disabled = false;
                post.value = "submit"

                console.log(e)
            })
        })

        var get = document.getElementById("get")
        var statusP = document.getElementById("status")
        var urlP = document.getElementById("urlresult")

        get.addEventListener("click", () => {
            get.disabled = true;
            get.value = "loading"

            var data = {
                id: document.getElementById("getId").value,
            }
            console.log("get")
            console.log(data)
            fetch("https://35647flwmbq46rhlty6ulnbnhq0jyxni.lambda-url.eu-central-1.on.aws/", {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).then(res => {
                get.disabled = false;
                get.value = "submit"


                res.json().then(json => {
                    console.log(json)
                    statusP.innerHTML = json.status
                    urlP.innerHTML = json.url

                })
                console.log("Get request complete! response:", res)
            }).catch(e => {
                get.disabled = false;
                get.value = "submit"


                console.log(e)
            })
        })


    </script>

</body>

</html>